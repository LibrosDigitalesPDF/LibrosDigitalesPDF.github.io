<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat√°logo Digital</title>
    <style>
        /* --- ESTILOS MODERNOS --- */
        :root { --primary: #2563eb; --dark: #1e293b; --bg: #f8fafc; --white: #ffffff; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin: 0; padding-bottom: 40px; }

        /* --- CABECERA FIJA --- */
        header { background: var(--white); padding: 15px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        
        .header-content { max-width: 1000px; margin: 0 auto; display: flex; flex-direction: column; gap: 15px; align-items: center; }
        
        /* LOGO DEL SITIO */
        .site-logo { 
            max-height: 80px; /* Tama√±o m√°ximo para que no sea gigante */
            width: auto; 
            display: block;
            border-radius: 8px; /* Un poco de borde redondeado opcional */
        }

        /* BUSCADOR */
        .search-box { position: relative; width: 100%; }
        .search-input { 
            width: 100%; padding: 12px 20px; padding-left: 40px; 
            border-radius: 25px; border: 1px solid #e2e8f0; 
            background: #f1f5f9; font-size: 16px; outline: none; box-sizing: border-box; transition: 0.3s;
        }
        .search-input:focus { background: white; box-shadow: 0 2px 8px rgba(37,99,235,0.2); border-color: var(--primary); }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #94a3b8; }

        /* FILTROS (CHIPS) */
        .nav-chips { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; width: 100%; justify-content: center; -webkit-overflow-scrolling: touch; }
        .chip { 
            padding: 8px 16px; border-radius: 20px; background: white; border: 1px solid #e2e8f0; 
            color: #64748b; font-weight: 600; cursor: pointer; white-space: nowrap; transition: 0.2s; 
        }
        .chip.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* --- CONTENEDORES --- */
        .container { max-width: 1000px; margin: 20px auto; padding: 0 15px; }
        
        /* GRID RESPONSIVE */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; }

        /* --- TARJETAS --- */
        .card { 
            background: white; border-radius: 12px; overflow: hidden; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: transform 0.2s; cursor: pointer;
            display: flex; flex-direction: column;
        }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px rgba(0,0,0,0.1); }

        .card-img { width: 100%; height: 240px; object-fit: cover; background: #eee; }
        .card-body { padding: 12px; }
        .card-title { font-weight: bold; color: var(--dark); font-size: 1em; margin-bottom: 5px; line-height: 1.3; }
        .card-sub { color: #64748b; font-size: 0.85em; }
        .card-badge { display: inline-block; background: #dbeafe; color: var(--primary); font-size: 0.75em; padding: 2px 8px; border-radius: 4px; margin-top: 5px; }

        /* --- VISTA DETALLE --- */
        #vista-detalle { display: none; }
        .detalle-header { text-align: center; background: white; padding: 30px 20px; border-radius: 0 0 20px 20px; margin-bottom: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        
        .perfil-img { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.2); margin-bottom: 15px; }
        .pack-img { width: 140px; height: 200px; border-radius: 8px; object-fit: cover; box-shadow: 0 5px 15px rgba(0,0,0,0.3); margin-bottom: 15px; }
        
        .detalle-titulo { font-size: 1.8em; font-weight: 800; color: var(--dark); margin: 0; }
        .detalle-sub { color: #64748b; margin-top: 5px; max-width: 600px; margin-left: auto; margin-right: auto; }
        .btn-volver { background: transparent; border: none; color: var(--primary); font-weight: bold; cursor: pointer; margin-bottom: 10px; display: inline-flex; align-items: center; gap: 5px; font-size: 16px; }

        /* --- MEDIA QUERY M√ìVIL --- */
        @media (max-width: 768px) {
            .grid { grid-template-columns: repeat(2, 1fr); gap: 15px; } 
            .card-img { height: 200px; }
            .nav-chips { justify-content: flex-start; } /* Scroll horizontal en m√≥vil */
            .site-logo { max-height: 60px; } /* Logo un poco m√°s chico en m√≥vil */
        }
    </style>
</head>
<body>

    <header>
        <div class="header-content">
            <img src="logo.jpeg" alt="Logo Cat√°logo" class="site-logo">

            <div class="search-box">
                <span class="search-icon">üîç</span>
                <input type="text" id="buscador" class="search-input" placeholder="Buscar libro, autor, g√©nero..." onkeyup="filtrarGlobal()">
            </div>

            <div class="nav-chips">
                <div class="chip active" onclick="cambiarVista('libros', this)">üìö Libros</div>
                <div class="chip" onclick="cambiarVista('autores', this)">‚úçÔ∏è Autores</div>
                <div class="chip" onclick="cambiarVista('packs', this)">üì¶ Packs</div>
                <div class="chip" onclick="cambiarVista('generos', this)">üè∑Ô∏è G√©neros</div>
            </div>
        </div>
    </header>

    <div id="loader" style="text-align: center; padding: 40px; color: #64748b;">
        Cargando cat√°logo... ‚è≥
    </div>

    <div id="vista-principal" class="container">
        <div id="grid-contenido" class="grid">
            </div>
    </div>

    <div id="vista-detalle">
        <div class="container">
            <button class="btn-volver" onclick="cerrarDetalle()">‚Üê Volver al cat√°logo</button>
            
            <div class="detalle-header">
                <img id="det-img" src="" class="perfil-img"> 
                <h1 id="det-titulo" class="detalle-titulo"></h1> 
                <p id="det-info" class="detalle-sub"></p>
            </div>

            <h3 style="margin-left: 15px; color: #64748b;">Libros Disponibles</h3>
            <div id="grid-detalle" class="grid"></div>
        </div>
    </div>

    <script>
        // ==========================================
        // URL DE TU API GOOGLE SCRIPT (YA CONFIGURADA)
        // ==========================================
        const API_URL = "https://script.google.com/macros/s/AKfycbxR9owUKbqXlUj3-hDYZKnFSxHqr1ZHl42z30kWREzJvFhHYwFShP1up5RPm8tuG_RC/exec"; 

        // Variables Globales
        let db = { libros: [], autores: [], packs: [] };
        let vistaActual = 'libros';

        // INICIO
        window.onload = function() {
            fetch(API_URL, { method: "POST", body: JSON.stringify({ accion: "leerTodo" }) })
            .then(res => res.json())
            .then(data => {
                if(data.libros) db.libros = data.libros.map(r => ({ id: r[0], titulo: r[1], autor: r[2], genero: r[3], paginas: r[4], portada: r[5], pack: r[6] }));
                if(data.autores) db.autores = data.autores.map(r => ({ id: r[0], nombre: r[1], foto: r[2], bio: r[3] }));
                if(data.packs) db.packs = data.packs.map(r => ({ id: r[0], nombre: r[1], foto: r[2] }));

                document.getElementById('loader').style.display = 'none';
                renderizarContenido(); 
            })
            .catch(e => {
                document.getElementById('loader').innerHTML = "Error cargando datos. Revisa tu conexi√≥n.";
                console.error(e);
            });
        };

        // --- NAVEGACI√ìN ---
        function cambiarVista(vista, btn) {
            vistaActual = vista;
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            if(btn) btn.classList.add('active');

            document.getElementById('vista-principal').style.display = 'block';
            document.getElementById('vista-detalle').style.display = 'none';
            document.getElementById('buscador').value = ''; 
            
            renderizarContenido();
        }

        // --- RENDERIZADO PRINCIPAL ---
        function renderizarContenido() {
            const grid = document.getElementById('grid-contenido');
            grid.innerHTML = "";
            let html = "";
            
            if (vistaActual === 'libros') {
                db.libros.forEach(l => {
                    html += `
                    <div class="card">
                        <img src="${l.portada}" class="card-img" onerror="this.src='https://via.placeholder.com/200?text=Sin+Portada'">
                        <div class="card-body">
                            <div class="card-title">${l.titulo}</div>
                            <div class="card-sub">üë§ ${l.autor}</div>
                            ${l.pack ? `<div class="card-badge">üì¶ ${l.pack}</div>` : ''}
                        </div>
                    </div>`;
                });
            } 
            else if (vistaActual === 'autores') {
                db.autores.forEach(a => {
                    html += `
                    <div class="card" onclick="abrirDetalle('autor', '${a.nombre}', '${a.foto}', '${a.bio}')">
                        <img src="${a.foto}" class="card-img" style="object-fit:cover;" onerror="this.src='https://via.placeholder.com/200?text=Autor'">
                        <div class="card-body" style="text-align:center">
                            <div class="card-title">${a.nombre}</div>
                            <div class="card-sub">Ver colecci√≥n ‚Üí</div>
                        </div>
                    </div>`;
                });
            }
            else if (vistaActual === 'packs') {
                db.packs.forEach(p => {
                    html += `
                    <div class="card" onclick="abrirDetalle('pack', '${p.nombre}', '${p.foto}', 'Saga completa')">
                        <img src="${p.foto}" class="card-img" onerror="this.src='https://via.placeholder.com/200?text=Pack'">
                        <div class="card-body">
                            <div class="card-title">${p.nombre}</div>
                            <div class="card-sub">üì¶ Colecci√≥n</div>
                        </div>
                    </div>`;
                });
            }
            else if (vistaActual === 'generos') {
                const generos = [...new Set(db.libros.map(l => l.genero).filter(g => g))].sort();
                generos.forEach(g => {
                    html += `
                    <div class="card" onclick="abrirDetalle('genero', '${g}', '', 'Categor√≠a')">
                        <div class="card-body" style="text-align:center; padding: 40px 10px;">
                            <div style="font-size:2em;">üè∑Ô∏è</div>
                            <div class="card-title" style="margin-top:10px;">${g}</div>
                        </div>
                    </div>`;
                });
            }

            grid.innerHTML = html;
        }

        // --- VISTA DETALLE ---
        function abrirDetalle(tipo, nombre, foto, bio) {
            document.getElementById('vista-principal').style.display = 'none';
            document.getElementById('vista-detalle').style.display = 'block';
            window.scrollTo(0,0);

            const imgEl = document.getElementById('det-img');
            
            if(tipo === 'autor') {
                imgEl.className = 'perfil-img';
                imgEl.src = foto || 'https://via.placeholder.com/150?text=Autor';
                imgEl.style.display = 'inline-block';
            } else if (tipo === 'pack') {
                imgEl.className = 'pack-img';
                imgEl.src = foto || 'https://via.placeholder.com/150?text=Pack';
                imgEl.style.display = 'inline-block';
            } else {
                imgEl.style.display = 'none';
            }
            
            document.getElementById('det-titulo').textContent = nombre;
            document.getElementById('det-info').textContent = bio || "";

            const gridDetalle = document.getElementById('grid-detalle');
            let librosFiltrados = [];

            if (tipo === 'autor') librosFiltrados = db.libros.filter(l => l.autor === nombre);
            else if (tipo === 'pack') librosFiltrados = db.libros.filter(l => l.pack === nombre);
            else if (tipo === 'genero') librosFiltrados = db.libros.filter(l => l.genero === nombre);

            gridDetalle.innerHTML = librosFiltrados.map(l => `
                <div class="card">
                    <img src="${l.portada}" class="card-img" onerror="this.src='https://via.placeholder.com/200?text=Libro'">
                    <div class="card-body">
                        <div class="card-title">${l.titulo}</div>
                        <div class="card-sub">üìñ ${l.paginas} p√°gs</div>
                    </div>
                </div>
            `).join('');

            if(librosFiltrados.length === 0) gridDetalle.innerHTML = "<p style='text-align:center; width:100%; color:#666'>No hay libros aqu√≠.</p>";
        }

        function cerrarDetalle() {
            document.getElementById('vista-principal').style.display = 'block';
            document.getElementById('vista-detalle').style.display = 'none';
        }

        // --- BUSCADOR ---
        function filtrarGlobal() {
            const txt = document.getElementById('buscador').value.toLowerCase();
            
            if(vistaActual === 'libros') {
                const filtrados = db.libros.filter(l => (l.titulo+l.autor+l.pack+l.genero).toLowerCase().includes(txt));
                const grid = document.getElementById('grid-contenido');
                
                grid.innerHTML = filtrados.map(l => `
                    <div class="card">
                        <img src="${l.portada}" class="card-img" onerror="this.src='https://via.placeholder.com/200?text=Libro'">
                        <div class="card-body">
                            <div class="card-title">${l.titulo}</div>
                            <div class="card-sub">üë§ ${l.autor}</div>
                        </div>
                    </div>`).join('');
            } else {
                if(txt.length > 0) {
                    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                    document.querySelector('.chip:first-child').classList.add('active');
                    vistaActual = 'libros';
                    filtrarGlobal();
                } else {
                    renderizarContenido();
                }
            }
        }
    </script>
</body>
</html>
